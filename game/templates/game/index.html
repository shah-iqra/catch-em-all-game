<!DOCTYPE html>
<html>
<head>
    <title>Arcade Fun: Catch 'Em All! (Dynamic Difficulty)</title>
    <style>
        /* --- General Styles --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            color: #263238;
            overflow: hidden;
            text-align: center;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- Header --- */
        #header {
            /* Displayed by default now */
            display: flex; 
            padding: 15px;
            background: rgba(0,0,0,0.15);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            /* Added flex properties for header content alignment */
            justify-content: space-between; 
            align-items: center;
            flex-wrap: wrap;
        }
        h1 { 
            margin: 0 10px;
            font-size: 38px;
            text-shadow: 2px 2px 5px #000;
            color: #ffeb3b;
        }
        #controls {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
        #scoreBoard, #highScoreBoard, #multiplierStatus {
            margin: 0 10px;
            font-weight: bold;
            flex-basis: 100%; /* Ensure score/status take full width on new line */
            text-align: left;
            padding: 5px 10px;
        }
        #scoreBoard {
            font-size: 18px;
        }
        #highScoreBoard {
            font-size: 14px;
            color: #cfd8dc;
        }
        
        /* --- Buttons --- */
        .control-btn {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            border-radius: 50px;
            margin: 0 5px;
            box-shadow: 0 6px #388e3c;
            transition: all 0.3s ease;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        .control-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px #388e3c;
        }
        .control-btn:active {
            box-shadow: 0 2px #388e3c;
            transform: translateY(3px);
        }
        
        /* --- Game Container --- */
        #gameContainer {
            display: block; /* Displayed by default now */
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100vh; /* Takes full viewport height */
            /* Adjusted background to account for fixed header position */
            background: radial-gradient(circle at 50% 120%, #87ceeb 0%, #add8e6 60%, #b0e0e6 100%); 
            margin-top: 80px; /* Offset for the header */
        }

        /* --- Basket, Balls, Popups, Game Over Screen --- */
        #basket {
            position: absolute;
            bottom: 20px;
            width: 120px;
            height: 30px;
            background: linear-gradient(145deg, #ff5722, #ff9800);
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.9);
            transition: width 0.3s ease-out, left 0.05s linear, transform 0.1s;
            z-index: 5;
        }
        .basket-impact {
            transform: scale(1.05); 
            box-shadow: 0 5px 30px 5px rgba(255, 235, 59, 0.8);
        }
        .multiplier-active {
            box-shadow: 0 0 40px 10px #ffeb3b; 
            border: 3px solid #ff9800;
        }

        .ball {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.7);
            z-index: 4;
            transition: background-color 0.1s, transform 0.2s;
        }
        .normal { background: radial-gradient(circle, #ffeb3b, #fbc02d); }
        .bonus { background: radial-gradient(circle, #4caf50, #66bb6a); }
        .penalty { background: radial-gradient(circle, #ef5350, #e53935); }
        .widen-powerup { background: radial-gradient(circle, #9c27b0, #7b1fa2); } 
        .multiplier-powerup { background: radial-gradient(circle, #03a9f4, #00bcd4); } 

        .score-popup {
            position: absolute;
            font-size: 38px;
            font-weight: 900;
            color: #ffffff;
            opacity: 0;
            animation: scoreAnim 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            text-shadow: 2px 2px 8px #000;
            pointer-events: none;
            z-index: 20;
        }
        @keyframes scoreAnim {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-40px) scale(1.5); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.2); opacity: 0; }
        }

        /* --- Game Over Screen --- */
        #gameOverScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #gameOverPanel {
            background: linear-gradient(135deg, #37474f, #263238);
            padding: 60px 90px;
            border: 5px solid #ffeb3b;
            border-radius: 20px;
            box-shadow: 0 15px 45px 15px rgba(255, 235, 59, 0.6);
            color: #ffffff;
            animation: bounceIn 0.7s ease-out forwards;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        #finalScore {
            font-size: 72px;
            margin: 20px 0;
            color: #ff9800;
            text-shadow: 2px 2px 4px #000;
            font-weight: bold;
        }
        #highScoreTextGameOver {
            font-size: 22px;
            color: #81c784;
            margin-bottom: 25px;
            font-weight: bold;
        }
        #gameOverPanel h2 {
            font-size: 48px;
            margin-bottom: 10px;
            color: #ef5350;
            text-shadow: 2px 2px 5px #000;
        }

        /* --- Floating Background Balls --- */
        .bg-ball {
            width: 25px;
            height: 25px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            position: absolute;
            animation: floatUp 20s linear infinite;
            animation-delay: calc(var(--random-delay) * -1s);
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
            20% { opacity: 0.2; }
            80% { opacity: 0.1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body>

<div id="header">
    <h1>Arcade Fun: Catch 'Em All! üèÜ</h1>
    <div id="multiplierStatus" style="color: #03a9f4; font-weight: bold; margin-top: 5px; text-shadow: 1px 1px 2px #000;"></div> 
    
    <div id="controls">
        <button id="startBtn" class="control-btn" onclick="startGame()">Restart</button>
        <button id="pauseBtn" class="control-btn" onclick="togglePause()">Pause</button>
    </div>
    <div id="scoreBoard">Score: 0 | Lives: 3 | Speed: 5.0</div>
    <div id="highScoreBoard">High Score: 0</div>
</div>

<div id="gameContainer">
    <div id="basket"></div>
</div>

<div id="gameOverScreen">
    <div id="gameOverPanel">
        <h2>GAME OVER! üíî</h2>
        <div id="finalScoreText">Your Final Score:</div>
        <div id="finalScore">0</div>
        <div id="highScoreTextGameOver"></div>
        <button class="control-btn" onclick="startGame()">Play Again</button>
    </div>
</div>

<script>
// --- Floating Background Balls Initialization ---
for(let i=0;i<30;i++){
    const b = document.createElement('div');
    b.className='bg-ball';
    b.style.left=Math.random()*100+'vw';
    b.style.animationDuration=10+Math.random()*10+'s';
    b.style.width=10+Math.random()*20+'px';
    b.style.height=b.style.width;
    b.style.opacity=0.2+Math.random()*0.5;
    b.style.setProperty('--random-delay', Math.random() * 20); 
    document.body.appendChild(b);
}

// --- JavaScript Game Logic ---

// const startScreen = document.getElementById('startScreen'); // REMOVED
const header = document.getElementById('header');
const gameContainer = document.getElementById('gameContainer');
const basket = document.getElementById('basket');
const scoreBoard = document.getElementById('scoreBoard');
const highScoreBoard = document.getElementById('highScoreBoard');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScoreDisplay = document.getElementById('finalScore');
const highScoreTextGameOver = document.getElementById('highScoreTextGameOver');
const multiplierStatus = document.getElementById('multiplierStatus');

let score = 0;
let lives = 3;
let baseSpeed = 5; 
let currentSpeed = baseSpeed;
let ballCreationInterval;
let balls = [];
let isGameRunning = false;
let powerupTimeout;
let impactTimeout;
let basketPos = 0; 

// New Multiplier Variables
let scoreMultiplier = 1;
let multiplierTimeout;

// Load High Score
let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
highScoreBoard.innerText = `High Score: ${highScore}`;


// Fixed Base Rates for a dynamic single mode
const INITIAL_BALL_RATE = 900; 
const START_NORMAL_RATE = 0.70; 
const START_BONUS_RATE = 0.15;
const START_PENALTY_RATE = 0.05;
const START_WIDEN_RATE = 0.05; 
const START_MULTIPLIER_RATE = 0.05; 


// --- Scoring Messages ---
const goodCatchMessages = ["Great Catch!", "Nice!", "Perfect!", "Awesome!", "Score!"];
const bonusCatchMessages = ["BONUS!", "Life Up!", "Extra Points!"];
const penaltyCatchMessages = ["Oops!", "Penalty!", "Missed Opportunity!"];
const widenMessages = ["Power Up!", "Widen!", "Basket Boost!"];
const multiplierMessages = ["3X Score!", "Multiplier Active!", "Mega Points!"];


// --- Utility Functions ---

function showScorePopup(text, x, y, color = '#ffffff') {
    const popup = document.createElement('div');
    popup.classList.add('score-popup');
    popup.innerText = text;
    popup.style.left = x + 'px';
    // Offset the position by header height to appear correctly in gameContainer
    const headerHeight = header.offsetHeight; 
    popup.style.top = (y - headerHeight) + 'px'; 
    popup.style.color = color;
    gameContainer.appendChild(popup);
    
    setTimeout(() => {
        popup.remove();
    }, 1000);
}

function updateScore() {
    scoreBoard.innerText = `Score: ${score} | Lives: ${lives} | Speed: ${currentSpeed.toFixed(1)}`;
    highScoreBoard.innerText = `High Score: ${highScore}`;
    
    // Multiplier Status Update
    if (scoreMultiplier > 1) {
        multiplierStatus.innerText = `Multiplier: ${scoreMultiplier}x ACTIVE!`;
    } else {
        multiplierStatus.innerText = '';
    }

    // Automatic Difficulty Progression
    let speedIncrease = Math.floor(score / 10) * 0.5;
    let newSpeed = baseSpeed + speedIncrease;
    
    if (newSpeed !== currentSpeed && newSpeed <= 25) { 
        currentSpeed = newSpeed;
        restartBallCreation();
    }
}

function basketImpactVisual() {
    basket.classList.add('basket-impact');
    clearTimeout(impactTimeout);
    impactTimeout = setTimeout(() => {
        basket.classList.remove('basket-impact');
    }, 100);
}

function handleGameOver() {
    clearInterval(ballCreationInterval);
    clearTimeout(powerupTimeout);
    clearTimeout(multiplierTimeout); 
    balls.forEach(b => {
        clearInterval(b.interval);
        b.element.remove();
    });
    balls = [];
    isGameRunning = false;
    resetBasketSize();
    scoreMultiplier = 1; 
    
    if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
        highScoreTextGameOver.innerText = "‚≠ê NEW HIGH SCORE! ‚≠ê";
    } else {
        highScoreTextGameOver.innerText = `Keep Going! Need ${highScore - score + 1} more to beat High Score.`;
    }
    
    finalScoreDisplay.innerText = score;
    gameOverScreen.style.display = 'flex';
    
    // Header remains, but controls might change state if needed
}

/* function showStartScreen() { // REMOVED
    gameOverScreen.style.display = 'none';
    startScreen.style.display = 'flex';
} */

function restartBallCreation() {
    clearInterval(ballCreationInterval);
    let creationTime = Math.max(100, INITIAL_BALL_RATE - (currentSpeed - baseSpeed) * 100); 
    ballCreationInterval = setInterval(createBall, creationTime);
}

// Basket Sizing Functions
let defaultBasketWidth = 120;
let basketWidth = defaultBasketWidth;

function setBasketSize(width) {
    basketWidth = width;
    basket.style.width = basketWidth + 'px';
}

function resetBasketSize() {
    setBasketSize(defaultBasketWidth);
    basket.style.backgroundImage = 'linear-gradient(145deg, #ff5722, #ff9800)';
    basket.classList.remove('multiplier-active'); 
}

// Power-Up Handling
function activatePowerUp(type) {
    // Determine the position for the powerup popup
    const popupX = gameContainer.offsetWidth / 2;
    const popupY = gameContainer.offsetHeight + header.offsetHeight - 50; // Place it just above the basket area

    if (type === 'Widen') {
        clearTimeout(powerupTimeout);
        resetBasketSize(); 
        
        setBasketSize(200);
        basket.style.backgroundImage = 'radial-gradient(circle, #9c27b0, #7b1fa2)';
        showScorePopup(widenMessages[Math.floor(Math.random() * widenMessages.length)], popupX, popupY, '#9c27b0');
        powerupTimeout = setTimeout(resetBasketSize, 5000);
    } else if (type === 'Multiplier') {
        clearTimeout(multiplierTimeout); 
        
        scoreMultiplier = 3;
        basket.classList.add('multiplier-active');
        showScorePopup(multiplierMessages[Math.floor(Math.random() * multiplierMessages.length)], popupX, popupY, '#03a9f4');
        updateScore(); 
        
        multiplierTimeout = setTimeout(() => {
            scoreMultiplier = 1;
            basket.classList.remove('multiplier-active');
            updateScore(); 
        }, 5000); 
    }
}


// --- Game Initialization & Controls ---

function startGame() {
    // startScreen.style.display = 'none'; // REMOVED
    gameOverScreen.style.display = 'none';
    // header.style.display = 'flex'; // Already visible
    // gameContainer.style.display = 'block'; // Already visible
    
    score = 0;
    lives = 3;
    currentSpeed = baseSpeed; 
    scoreMultiplier = 1; 
    resetBasketSize();
    clearTimeout(powerupTimeout);
    clearTimeout(multiplierTimeout);
    
    // Clear any existing balls from previous session
    balls.forEach(b => {
        clearInterval(b.interval);
        b.element.remove();
    });
    balls = [];

    updateScore();

    pauseBtn.innerText = "Pause";
    isGameRunning = true;
    
    restartBallCreation();
}

gameContainer.addEventListener('mousemove', e => {
    if (!isGameRunning) return;
    const rect = gameContainer.getBoundingClientRect();
    let x = e.clientX - rect.left; 
    let currentBasketWidth = parseInt(basket.style.width); 
    basketPos = x - currentBasketWidth / 2;
    
    if(basketPos < 0) basketPos = 0;
    if(basketPos > gameContainer.offsetWidth - currentBasketWidth) basketPos = gameContainer.offsetWidth - currentBasketWidth;
    
    basket.style.left = basketPos + 'px';
});


function togglePause() {
    if (isGameRunning) {
        isGameRunning = false;
        pauseBtn.innerText = "Resume";
        clearInterval(ballCreationInterval);
        balls.forEach(b => clearInterval(b.interval)); 
        clearTimeout(powerupTimeout);
        clearTimeout(multiplierTimeout);
    } else {
        isGameRunning = true;
        pauseBtn.innerText = "Pause";
        restartBallCreation(); 
        balls.forEach(b => moveBall(b)); 
    }
}

function createBall() {
    // ... (Ball creation logic remains the same)

    const ballElement = document.createElement('div');
    
    let type;
    let rand = Math.random();
    
    let dynamicPenaltyRate = START_PENALTY_RATE + Math.min(0.2, (currentSpeed - baseSpeed) / 25);
    
    let cumulativeRate = START_NORMAL_RATE;
    if (rand < cumulativeRate) {
        type = 'normal';
    } else {
        cumulativeRate += START_BONUS_RATE;
        if (rand < cumulativeRate) {
            type = 'bonus';
        } else {
            cumulativeRate += dynamicPenaltyRate;
            if (rand < cumulativeRate) {
                type = 'penalty';
            } else {
                cumulativeRate += START_WIDEN_RATE;
                if (rand < cumulativeRate) {
                    type = 'widen-powerup'; 
                } else {
                    type = 'multiplier-powerup'; 
                }
            }
        }
    }

    ballElement.classList.add('ball', type);
    ballElement.style.left = Math.random() * (gameContainer.offsetWidth - 35) + 'px';
    ballElement.style.top = '0px';
    gameContainer.appendChild(ballElement);

    const ballObject = {
        element: ballElement,
        type: type,
        interval: null, 
    };

    balls.push(ballObject);
    moveBall(ballObject);
}

function moveBall(ball) {
    // ... (Ball movement and collision logic remains the same)

    if (ball.interval) clearInterval(ball.interval); 

    ball.interval = setInterval(() => {
        if (!isGameRunning) return; 
        
        let top = parseInt(ball.element.style.top);
        top += currentSpeed; 
        ball.element.style.top = top + 'px';
        
        const ballHeight = 35;
        // Adjusted calculation to account for the header offset.
        const catchZoneBottom = gameContainer.offsetHeight + header.offsetHeight - 20; 

        if(top + ballHeight + header.offsetHeight >= catchZoneBottom) { 
            const ballLeft = parseInt(ball.element.style.left);
            const ballRight = ballLeft + ballHeight;
            const basketLeft = basketPos;
            const basketRight = basketPos + parseInt(basket.style.width); 
            
            let feedback = '';
            let feedbackColor = '#ffffff';

            // Collision check
            if(ballRight > basketLeft && ballLeft < basketRight) {
                // Caught logic
                basketImpactVisual();
                
                let points = 0;
                let isPowerup = false;

                if (ball.type === 'normal') {
                    points = 1;
                    feedback = goodCatchMessages[Math.floor(Math.random() * goodCatchMessages.length)];
                    feedbackColor = '#ffeb3b';
                } else if (ball.type === 'bonus') {
                    points = 10;
                    lives = Math.min(5, lives + 1);
                    feedback = bonusCatchMessages[Math.floor(Math.random() * bonusCatchMessages.length)];
                    feedbackColor = '#4caf50';
                } else if (ball.type === 'penalty') {
                    points = -5; 
                    lives--;
                    feedback = penaltyCatchMessages[Math.floor(Math.random() * penaltyCatchMessages.length)];
                    feedbackColor = '#ef5350';
                } else if (ball.type === 'widen-powerup') {
                    activatePowerUp('Widen');
                    isPowerup = true;
                    feedback = widenMessages[Math.floor(Math.random() * widenMessages.length)];
                    feedbackColor = '#9c27b0';
                } else if (ball.type === 'multiplier-powerup') {
                    activatePowerUp('Multiplier');
                    isPowerup = true;
                    feedback = multiplierMessages[Math.floor(Math.random() * multiplierMessages.length)];
                    feedbackColor = '#03a9f4';
                }

                // Apply Multiplier
                if (!isPowerup) {
                    let multipliedPoints = points * scoreMultiplier;
                    score = Math.max(0, score + multipliedPoints);
                    if (scoreMultiplier > 1 && points > 0) {
                        feedback += ` (+${multipliedPoints} points!)`;
                    } else if (scoreMultiplier > 1 && points < 0) {
                        feedback += ` (${multipliedPoints} penalty!)`;
                    }
                }
            } else {
                // Missed logic
                if (ball.type !== 'bonus') {
                    lives--;
                }
                feedback = 'MISSED!';
                feedbackColor = '#78909c';
            }
            
            // The popup needs the total screen coordinates for showScorePopup
            showScorePopup(feedback, ballLeft, top + header.offsetHeight, feedbackColor); 
            updateScore();
            clearInterval(ball.interval);
            ball.element.remove();
            balls = balls.filter(b => b !== ball);
            
            if(lives <= 0) {
                handleGameOver();
            }
        }

    }, 30);
}

function init() {
    // Initial basket placement
    basketPos = (window.innerWidth - defaultBasketWidth) / 2;
    basket.style.left = basketPos + 'px';
    highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
    
    // Auto-start the game
    startGame();
}

// Attach event listener to window load instead of resize for initial call
window.addEventListener('load', init); 
window.addEventListener('resize', init);
</script>

</body>
</html>